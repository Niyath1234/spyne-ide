[
  {
    "id": "khatabook_tos",
    "system": "khatabook",
    "metric": "tos",
    "target_entity": "loan",
    "target_grain": ["loan_id"],
    "computation": {
      "description": "Total Outstanding = Sum of (EMI Amount - Transaction Amount) per loan",
      "source_entities": ["loan", "emi", "transaction"],
      "attributes_needed": {
        "emi": ["loan_id", "emi_number", "amount"],
        "transaction": ["loan_id", "emi_number", "amount"]
      },
      "formula": "SUM(emi_amount - COALESCE(transaction_amount, 0))",
      "aggregation_grain": ["loan_id"]
    }
  },
  {
    "id": "tb_tos",
    "system": "tb",
    "metric": "tos",
    "target_entity": "loan",
    "target_grain": ["loan_id"],
    "computation": {
      "description": "Total Outstanding from pre-computed loan summary",
      "source_entities": ["loan"],
      "attributes_needed": {
        "loan": ["loan_id", "total_outstanding"]
      },
      "formula": "total_outstanding",
      "aggregation_grain": ["loan_id"]
    }
  }
]
